# 项目概览

项目基于 Vue3 + 组合式 API（JavaScript）开发，使用 Pinia 统一管理用户与购物车等核心状态。  
请求层通过 Axios 进行统一封装，并结合拦截器处理通用逻辑；基于模拟 token 实现用户身份标识与数据隔离。
组件选择自己封装多数组件，采用部分vant4组件。
数据层使用 json-server 模拟后端接口，用于还原完整的电商业务流程。

- 项目整体架构与性能优化说明：见 **项目整体架构设计 / 数据加载与性能优化、用户体验优化**
- 通用组件封装说明：见 **个人组件封装**
- 业务组件二次封装说明：见 **Vant4 组件封装**

# 启动说明

1. 关于启动，根据自己的包管理工具
   - 先下载全部依赖包
   - 终端1：输入mock（启动jsonserver数据库在localhost:3727）
   - 终端2：输入dev（启动项目）

# 技术栈与选型说明

## 总体

- 基于 Vue3 组合式 API、Pinia、Axios 开发，结合路由守卫做页面鉴权，以 HTML 构建结构、CSS/LESS 编写样式、JS 实现业务逻辑，轻量引入 Vant4 组件，通过 json-server 模拟后端服务及接口，实现用户数据隔离。

## 前端框架：Vue3

- 使用 Vue3进行项目开发  
- 采用 Composition API 编写业务逻辑  
- 结构更清晰，方便后期维护

## 状态管理：Pinia

- 使用 Pinia 管理全局状态  
- 按业务拆分 Store，避免状态混乱  
- 配合持久化插件，解决部分信息刷新后状态丢失问题

## 模拟后端：json-server

- 使用 json-server 模拟后端接口  
- 支持基本的增删改查操作

## UI 组件库：Vant4 + 自己封装一些组件

- 使用 Vant4 作为基础 UI 组件库
- 按需引入组件，减少冗余
- 对常用 Toast、Dialog 做简单封装，统一使用方式
- 自己封装组件可到组件封装查看

# 项目整体架构设计

## 1. db 数据库（json-server）

1. 使用json-server初始化本地 db 数据库  
   - 模拟后端接口  
   - 支撑前端完整业务流程的数据读写与状态变更  

2. 在 `package.json` 中配置 `mock` 启动命令  
   - 指定端口号 `3727`

3. 数据结构设计  
   - 采用高聚合式数据存储
   - 不采用扁平化结构  
   - 设计思路贴近真实后端数据模型，减少前端业务层的二次拼装逻辑  

## 2. Pinia 状态管理

### 2.1 Pinia 初始化配置

1. 使用 `createPinia` 创建全局状态管理实例  
2. 引入 `pinia-plugin-persistedstate` 插件，实现状态本地持久化  
3. 在 `store/index.js` 中统一完成 Pinia 初始化与插件注册  
4. 通过 index 文件集中导出各业务模块，方便在项目中按需引入  

### 2.2 仓库模块化设计

1. 将不同业务状态拆分为独立 Store  
2. 每个 Store 只负责单一业务领域的数据与逻辑  
3. 当前项目主要包含以下模块：
   - `user`：用户信息与地址信息管理
   - `cart`：购物车相关状态与计算逻辑

### 2.3 User 仓库（用户模块）

1. 使用组合式 API 形式定义 Store  
2. 使用 `json-server` 中的用户 `id` 模拟登录 token对各个用户的数据分离
3. 主要负责以下状态管理：
   - 用户登录 token
   - 用户名基础信息
   - 用户真实收货信息（姓名 / 地址 / 手机号）
   - 是否已完善收货信息的标识状态  

4. 提供的核心功能：
   - 设置与清除本地用户信息
   - 异步获取用户真实收货信息
   - 异步更新用户收货信息并同步至后端
   - 配合下单流程判断用户信息是否完善  

5. 通过 Pinia 持久化插件实现用户状态的本地缓存，避免页面刷新导致状态丢失

### 2.4 Cart 仓库（购物车模块）

1. 独立管理用户购物车数据  
2. 所有购物车数据均以数组形式集中维护  
3. 主要包含以下状态：
   - 全部购物车商品列表
   - 商品选中状态
   - 商品数量与价格信息  

4. 使用 `computed` 对购物车数据进行派生计算：
   - 已选商品列表
   - 已选商品总数量
   - 已选商品总价格  

5. 提供的核心业务方法：
   - 异步获取当前用户购物车数据
   - 新增商品至购物车
   - 修改单个商品数量
   - 删除已选中的购物车商品
   - 重置商品选中状态  

6. 所有购物车变更操作均会同步更新至后端，确保数据一致性

### 2.5 设计说明

1. Pinia 仅负责状态与业务逻辑，不直接参与页面渲染  
2. 页面组件通过调用 Store 方法触发业务行为  
3. 异步请求统一封装在 Store 内部，减少组件层逻辑复杂度  
4. 通过模块拆分保证状态结构清晰，便于后期维护与扩展  

## 3. Axios 与拦截器

### 3.1 Axios 基础配置

1. 对 Axios 进行统一封装  
2. 配置请求基地址（baseURL）与请求超时时间（timeout）  
3. 项目中所有接口请求均基于该实例发起，便于统一维护与扩展  

### 3.2 请求与响应拦截器

1. 在请求拦截器中统一处理 loading 状态  
   - 接口请求发起时展示 loading  
   - 数据返回或请求结束后关闭 loading  
   - 部分异步获取仓库数据的请求不使用 Vant4 的 `loadingToast`，避免影响页面交互体验  

2. 在响应拦截器中统一处理请求结果  
   - 请求成功后关闭 loading  
   - 请求超时或失败时关闭 loading，并通过 Toast 进行提示  
   - 避免 loading 未关闭导致页面阻塞，提高整体用户体验  

### 3.3 设计说明

1. 通过拦截器集中处理 loading 与异常逻辑，减少组件层重复代码  
2. 将通用交互逻辑下沉至请求层，提升代码复用性与可维护性  
3. 保证接口异常情况下页面状态可控，避免用户误操作

## 4. 路由与页面

1. 完成页面与路由的统一管理  
   - 基于 `layout` 作为主布局容器  
   - 子页面通过二级路由渲染  
   - 配置默认重定向，保证首次进入页面结构稳定  

2. 路由懒加载  
   - 使用动态 `import()` 按需加载页面组件  
   - 减少首屏资源体积，提升页面加载性能  

3. 路由守卫配置  
   - 路由切换时统一关闭 Toast，避免残留提示影响页面展示  
   - 对以下路由进行鉴权控制：  
     `/account`、`/order`、`/final`、`/myorder`、`/myaddress`  
   - 进入鉴权页面时，若未检测到用户 `token`，自动重定向至登录页  

4. 设计说明  
   - 将权限校验逻辑集中在路由层处理  
   - 避免在页面组件中重复编写鉴权代码  
   - 保证页面访问流程清晰、可控  

## 5. 组件封装与复用设计

### 5.1 组件封装原则

1. 所有公共组件遵循高内聚、低耦合的封装原则  
2. 组件仅负责自身的展示与交互逻辑，不直接参与业务数据获取  
3. 通过 props / emits / slots 与外部进行通信，避免组件间产生隐式依赖  
4. 公共组件支持在不同页面中复用，避免为单一页面定制组件  

## 6. 数据加载与性能优化、用户体验优化

### 6.2 列表渲染优化

1. 商品列表采用分批加载与分批渲染策略  
2. 每次仅渲染固定数量的数据，降低首屏 DOM 节点数量  
3. 列表渲染时为每一项提供 key，减少 Vue Diff 带来的性能开销
4. 图片加载采用懒加载优化首屏速度

### 6.3 计算属性与状态优化

1. 所有派生数据通过 computed 统一生成  
2. 避免在模板中直接书写复杂计算逻辑  
3. 将高频计算与业务判断下沉至 Store 层处理，减少组件重复计算

### 6.4 数据获取优化

1. 对于商品全量数据使用 `Map` 缓存 Promise，避免并发请求重复触发接口  
2. 缓存设置 TTL，有效期内直接复用请求结果  
3. 请求失败时自动清理缓存，确保下次请求可重新拉取数据  

### 6.5 用户交互体验优化

1. 关键操作均提供即时反馈提示  
2. 防止用户重复提交或高频点击触发重复请求  
3. 表单输入统一进行边界校验与异常兜底处理
4. 首页，搜索列表页加入商品列表骨架屏

## 7. API 接口层设计说明

### 7.1 购物车接口（Cart API）

#### 接口职责说明
购物车接口用于管理**用户维度的购物车数据**，所有操作均基于用户 `id 即 模拟 token`。

#### 接口说明

- **cartGetService**  
  获取当前用户的购物车商品数据，用于页面初始化与刷新兜底。

- **cartSetService**  
  更新当前用户的购物车商品列表，采用全量更新方式，保证数据一致性。

- **cartInitService**  
  初始化用户购物车数据结构，通常在用户首次注册或首次登录时调用。  

### 7.2 商品接口（Goods API）

#### 接口职责说明
商品接口用于获取商品列表与商品详情数据，并通过缓存机制优化性能。

#### 接口说明

- **goodsGetService**  
  获取全部商品数据，使用 Promise 缓存，避免重复请求。

- **goodsGetAscService**  
  按价格升序获取商品数据，独立缓存。

- **goodsGetDescService**  
  按价格降序获取商品数据，独立缓存。

- **goodsGetRandomService**  
  根据区间随机获取商品数据，用于模拟分页或推荐场景。

- **goodsGetOneService**  
  获取单个商品的详细信息，用于商品详情页与结算页。

### 7.3 订单接口（Order API）

#### 接口职责说明
订单接口用于管理用户的订单数据集合，与结算流程强相关。

#### 接口说明

- **orderGetService**  
  获取指定用户的全部订单信息。

- **orderSetService**  
  更新用户的订单列表，结算完成后写入新订单数据。

- **orderInitService**  
  初始化用户订单数据结构，避免首次下单时报错。  

### 7.4 搜索历史接口（History Search API）

#### 接口职责说明
搜索历史接口用于维护用户的搜索记录数据。

#### 接口说明

- **historyGetService**  
  获取当前的搜索历史数据。

- **historySetService**  
  更新用户搜索历史数组。

- **historyInitService**  
  初始化搜索历史数据结构。

### 7.5 轮播图接口（Swiper API）

#### 接口职责说明
用于获取首页轮播图图片资源。

#### 接口说明

- **swiperGetService**  
  获取轮播图图片 URL 列表。 

### 7.6 用户接口（User API）

#### 接口职责说明
用户接口用于管理用户账户信息与个人收货信息。

#### 接口说明

- **userRegisterService**  
  提交用户注册信息，并初始化用户相关字段。

- **userGetMessageService**  
  获取全部用户数据，用于登录校验。

- **userInitMessageService**  
  标记用户初始化状态
  登录都用户会初始化jsonserver下的`cart` `order` `historySearch` 仓库

- **userGetOneMessageService**  
  获取指定用户的详细信息。

- **userSetPasswordService**  
  修改指定用户的登录密码。

- **userSetMessageService**  
  更新用户的真实收货信息（地址 / 姓名 / 手机号）。
  并且更新该用户的地址信息为已填（express：true）

# vant4组件封装

1. 二次封装 `showToast`
   统一项目内 Toast 调用方式
   自定义样式（位置、背景、阴影等），避免默认样式不一致
   暴露 `message`、`duration` 参数，简化业务层调用

2. 二次封装 `showConfirmDialog`
   原组件参数冗长业务中频繁使用，故进行封装
   统一确认 / 取消文案参数（`message / yes / no`）
   支持传入 `router`、`route`
   登录拦截场景下，通过 `query.backUrl` 记录来源页面，配合 `replace` 实现登录后回跳

3. 二次封装 `showLoadingToast`
   用于请求加载态展示
   禁止点击、手动关闭
   避免在部分异步仓库操作中使用默认 Toast 造成体验割裂


# 个人组件封装

## 轮播图组件
### 1.1 说明
1. 该组件为无缝轮播图，支持动态绑定轮播图数量
2. 可通过传入图片URL数组的方式更改图片内容，图片数量不限
   类型（规定传递Array） 属性（imgArray）
   例：imgArray="[]" 必传
3. 属性可选择是否开启指示器
   类型（规定传递Boolean） 属性（nodebox）
   值（true不显示，false显示，默认false） 
4. 属性可设置轮播间隔时长，不可低于500
   类型（规定传递String） 属性（duration）
   例：duration="3000" 默认duration="5000"
5. 属性可设置轮播图框大小，注意：如用用vant4的vw适配要传用vw！！！
   类型（规定传递String）属性（mainWidth/mainHeight）默认（94.66vw/53.33vw）
   例：mainWidth="53.33vw"
### 1.2 功能
1. 内置指示器，表明当前的图片位置
2. 左右按钮控制显示轮播图， 加入节流功能防止频繁点击
3. 自动轮播功能，主动点击切换会重置自动轮播倒计时
4. 图片全部加载完毕才会触发自动轮播/有一张加载失败也会触发（避免卡着不轮播）

## 底部栏Bar
### 2.1 说明
1. 该组件为4处分类的具名插槽封装，支持自定义图标icon以及文字内容text，支持自定义跳转路由
2. 可通过v-slot:one/two/three/four-icon传入icon图标，例：v-slot:one-icon
3. 可通过v-slot:one/two/three/four-text传入text文字内容，例：v-slot:one-text
4. 可设置跳转路由
   类型（规定传递String） 属性（one/two/three/fourRouterGo）
   例：oneRouterGo="/layout/home" 必传
5. 可设置是否存在占位块
   属性（规定传递Boolean） 属性（existSpace）
   值（true存在，false不存在，默认false）
### 2.2 功能
1. 点击对应bar跳转路由，并激活状态active，改变对应的图标及文字颜色

## 顶部栏Bar
### 3.1 说明
1. 该组件为默认插槽顶部栏标题
2. 通过键入文字可改变标题
3. 可设置背景颜色
   类型（规定传递String） 属性（backgroundColor）
   例：backgroundColor="rgb(195, 20, 1)" 默认backgroundColor="rgb(195, 20, 1)"
4. 可设置字体颜色
   类型（规定传递String） 属性（fontColor）
   例：fontColor="#fff"
5. 可选择是否开启返回箭头
   类型（规定传递Boolean） 属性（existBackIcon）
   值：（true存在，false不存在，默认true）
### 3.2 功能
1. 点击左箭头<返回上一页

## 搜索栏
### 4.1 说明
1. 该组件为搜索组件
2. 固定位置与占位块属性为关联属性，见2.可知
3. 当isFixed=true时占位块不存在，isFixed=false时占位块存在，可通过existblock关闭
4. 可设置是否开启固定位置
   类型（规定传递Boolean） 属性（isFixed）
   值（true开启，false关闭，默认false）
5. 可设置不存在占位块
   类型（规定传递Boolean） 属性（existblock）
   值（false不存在，默认false）（仅能设置不存在）
6. 可设置是否进入页面自动聚焦
   类型（规定传递Boolean） 属性（FocusNow）
   值（true开启，false关闭，默认false）
### 4.2 功能
1. 回车向父级上传事件search以及搜索内容，自动清除前后空格，若未输入则不触发
2. 聚焦向父级上传事件onfocus以及true
3. 失焦向父级上传事件onblur以及false
4. 输入向父级上传事件oninput以及输入内容

## 商品卡片
### 5.1 说明
1. 该组件为商品卡片组件，用于展示商品信息
2. 可自定义图片/文字/价格内容
   通过v-slot:proimg/proname/proprice传入对应内容，例：v-slot:proimg
3. 文字/价格内容不限长度，利用不设height设line-height/word-break/direction自动撑开并对齐

## 商品卡片骨架图组件
### 5.1 说明
1. 该组件为商品卡片骨架图组件
2. 可指定骨架图数量
   类型（规定传递Number）属性skeleton，默认10
   例：:skeleton="10"

## 算术计算框组件
### 6.1 说明
1. 该组件为加减计算框组件，也可通过输入方式改变值
2. 组件已屏蔽错误信息返回，如NaN
3. 通过addCount传递值，需写为v-model:addCount="传递的值"
   也可拆分@update:addCount="(count)=>事件(count)" :addCount="Count"，事件内对会接受到传递后被update的Count值

### 6.1 功能
1. 点击加减号/输入input，传递加减/input后的数字
   输入非数字/失焦时为空为0，toast轻提示 请输入数字，并自动重置为1

# 页面处理

## 布局页（Layout）

### 页面职责
- 承载二级路由页面
- 统一管理底部导航栏组件
- 配合路由缓存控制页面状态

### 设计说明
- 布局页仅负责结构与导航管理，不承载具体业务逻辑  
- 页面缓存策略由路由统一控制  

## 首页（Home）

### 页面职责
- 展示商城首页核心内容
- 提供搜索入口与分类快捷入口
- 展示商品列表并支持上拉触发加载

### 设计说明
- 商品列表采用分批渲染，避免一次性渲染过多节点  
- 页面支持缓存与滚动位置恢复，保证页面切换体验 

## 分类页 / 商品列表页（Category / SearchList）

### 页面职责
- 展示分类或搜索匹配的商品列表
- 支持基础排序与滚动加载

### 设计说明
- 分类与搜索共用列表页结构，通过路由参数区分来源  
- 列表数据与排序状态分离管理，避免状态混乱  
- 商品列表统一采用上拉加载策略  

## 商品详情页（ProductDetail）

### 页面职责
- 展示单个商品的详细信息
- 提供加入购物车与立即购买操作

### 设计说明
- 商品信息与购物车状态分离处理  
- 所有购买行为统一校验用户登录状态  
- 页面只处理当前商品，不参与结算逻辑  

## 购物车页（Cart）

### 页面职责
- 展示并管理用户购物车商品
- 支持商品编辑、删除与结算操作
- 通过选中状态自由选中结算或编辑的商品进行操作

### 设计说明
- 购物车状态统一由 Pinia 管理  
- 页面仅负责操作触发与结果展示  
- 编辑模式与结算模式职责分离，避免误操作  

## 结算页（Settlement）

### 页面职责
- 汇总待购买商品信息
- 完成订单确认与下单流程

### 设计说明
- 支持从购物车或商品详情页进入  
- 页面刷新后可恢复结算数据，保证流程完整  
- 下单完成后统一跳转至结果页即支付成功
- 在结果页提供跳转首页或目标订单页功能

## 个人中心页（Mine）

### 页面职责
- 展示用户基础信息与登录状态
- 提供订单、地址、密码等管理功能入口

### 设计说明
- 用户登录状态由全局状态统一控制  
- 功能入口仅作为导航，不承载具体业务处理  
- 用户操作均进行登录态校验  
