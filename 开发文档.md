# 启动说明

1. 关于启动，根据自己的包管理工具
   - 先下载全部依赖包
   - 终端1：输入mock（启动jsonserver数据库在localhost:3727）
   - 终端2：输入dev（启动项目）

# 技术栈与选型说明

## 前端框架：Vue3

- 使用 Vue3进行项目开发  
- 采用 Composition API 编写业务逻辑  
- 结构更清晰，方便后期维护

## 状态管理：Pinia

- 使用 Pinia 管理全局状态  
- 按业务拆分 Store，避免状态混乱  
- 配合持久化插件，解决刷新后状态丢失问题

## 模拟后端：json-server

- 使用 json-server 模拟后端接口  
- 支持基本的增删改查操作  
- 满足项目开发与调试需求

## UI 组件库：Vant4

- 使用 Vant4作为基础 UI 组件库
- 按需引入组件，减少冗余
- 对常用 Toast、Dialog 做简单封装，统一使用方式

# 项目整体架构设计

## 1. db 数据库（json-server）

1. 使用 **json-server** 初始化本地 db 数据库  
   - 模拟后端 RESTful 接口  
   - 支撑前端完整业务流程的数据读写与状态变更  

2. 在 `package.json` 中配置 `mock` 启动命令  
   - 指定端口号 `3727`  
   - 统一前端本地开发与调试环境  

3. 数据结构设计  
   - 采用 **高聚合式数据存储** 
   - 不采用扁平化结构  
   - 设计思路贴近真实后端数据模型，减少前端业务层的二次拼装逻辑  


## 2. Pinia 状态管理

### 2.1 Pinia 初始化配置

1. 使用 `createPinia` 创建全局状态管理实例  
2. 引入 `pinia-plugin-persistedstate` 插件，实现状态本地持久化  
3. 在 `store/index.js` 中统一完成 Pinia 初始化与插件注册  
4. 通过 index 文件集中导出各业务模块，方便在项目中按需引入  

### 2.2 仓库模块化设计

1. 将不同业务状态拆分为独立 Store  
2. 每个 Store 只负责单一业务领域的数据与逻辑  
3. 当前项目主要包含以下模块：
   - `user`：用户信息与地址信息管理
   - `cart`：购物车相关状态与计算逻辑

### 2.3 User 仓库（用户模块）

1. 使用组合式 API 形式定义 Store  
2. 使用 `json-server` 中的用户 `id` 模拟登录 token  
3. 主要负责以下状态管理：
   - 用户登录 token
   - 用户名基础信息
   - 用户真实收货信息（姓名 / 地址 / 手机号）
   - 是否已完善收货信息的标识状态  

4. 提供的核心功能：
   - 设置与清除本地用户信息
   - 异步获取用户真实收货信息
   - 异步更新用户收货信息并同步至后端
   - 配合下单流程判断用户信息是否完善  

5. 通过 Pinia 持久化插件实现用户状态的本地缓存，避免页面刷新导致状态丢失

### 2.4 Cart 仓库（购物车模块）

1. 独立管理用户购物车数据  
2. 所有购物车数据均以数组形式集中维护  
3. 主要包含以下状态：
   - 全部购物车商品列表
   - 商品选中状态
   - 商品数量与价格信息  

4. 使用 `computed` 对购物车数据进行派生计算：
   - 已选商品列表
   - 已选商品总数量
   - 已选商品总价格  

5. 提供的核心业务方法：
   - 异步获取当前用户购物车数据
   - 新增商品至购物车
   - 修改单个商品数量
   - 删除已选中的购物车商品
   - 重置商品选中状态  

6. 所有购物车变更操作均会同步更新至后端，确保数据一致性

### 2.5 设计说明

1. Pinia 仅负责状态与业务逻辑，不直接参与页面渲染  
2. 页面组件通过调用 Store 方法触发业务行为  
3. 异步请求统一封装在 Store 内部，减少组件层逻辑复杂度  
4. 通过模块拆分保证状态结构清晰，便于后期维护与扩展  

## 3. Axios 与拦截器

### 3.1 Axios 基础配置

1. 对 Axios 进行统一封装  
2. 配置请求基地址（baseURL）与请求超时时间（timeout）  
3. 项目中所有接口请求均基于该实例发起，便于统一维护与扩展  

### 3.2 请求与响应拦截器

1. 在请求拦截器中统一处理 loading 状态  
   - 接口请求发起时展示 loading  
   - 数据返回或请求结束后关闭 loading  
   - 部分异步获取仓库数据的请求不使用 Vant4 的 `loadingToast`，避免影响页面交互体验  

2. 在响应拦截器中统一处理请求结果  
   - 请求成功后关闭 loading  
   - 请求超时或失败时关闭 loading，并通过 Toast 进行提示  
   - 避免 loading 未关闭导致页面阻塞，提高整体用户体验  

### 3.3 设计说明

1. 通过拦截器集中处理 loading 与异常逻辑，减少组件层重复代码  
2. 将通用交互逻辑下沉至请求层，提升代码复用性与可维护性  
3. 保证接口异常情况下页面状态可控，避免用户误操作

## 4. 路由与页面

1. 完成页面与路由的统一管理  
   - 基于 `layout` 作为主布局容器  
   - 子页面通过二级路由渲染  
   - 配置默认重定向，保证首次进入页面结构稳定  

2. 路由懒加载  
   - 使用动态 `import()` 按需加载页面组件  
   - 减少首屏资源体积，提升页面加载性能  

3. 路由守卫配置  
   - 路由切换时统一关闭 Toast，避免残留提示影响页面展示  
   - 对以下路由进行鉴权控制：  
     `/account`、`/order`、`/final`、`/myorder`、`/myaddress`  
   - 进入鉴权页面时，若未检测到用户 `token`，自动重定向至登录页  

4. 设计说明  
   - 将权限校验逻辑集中在路由层处理  
   - 避免在页面组件中重复编写鉴权代码  
   - 保证页面访问流程清晰、可控  

## 5. 组件封装与复用设计

### 5.1 组件封装原则

1. 所有公共组件遵循高内聚、低耦合的封装原则  
2. 组件仅负责自身的展示与交互逻辑，不直接参与业务数据获取  
3. 通过 props / emits / slots 与外部进行通信，避免组件间产生隐式依赖  
4. 公共组件支持在不同页面中复用，避免为单一页面定制组件  

## 6. 数据加载与性能优化

### 6.1 异步数据加载策略

1. 页面核心数据在 onMounted 生命周期中统一触发加载  
2. 不同业务数据拆分为独立接口请求，避免单一接口返回过多冗余字段  
3. 优先请求影响首屏展示的关键数据，非关键数据延后加载  

### 6.2 列表渲染优化

1. 商品列表采用分批加载与分批渲染策略  
2. 每次仅渲染固定数量的数据，降低首屏 DOM 节点数量  
3. 列表渲染时为每一项提供稳定的 key，减少 Vue Diff 带来的性能开销
4. 图片加载采用懒加载优化首屏速度

### 6.3 计算属性与状态优化

1. 所有派生数据通过 computed 统一生成  
2. 避免在模板中直接书写复杂计算逻辑  
3. 将高频计算与业务判断下沉至 Store 层处理，减少组件重复计算  

## 7. 业务流程设计

### 7.1 下单流程说明

1. 用户在商品详情页或列表页将商品加入购物车  
2. 在购物车页面选择需要结算的商品  
3. 点击结算按钮后进入订单确认页面  
4. 系统校验用户登录状态与收货信息完整性  
5. 校验通过后生成订单数据并提交至后端

## 8. 异常处理与用户体验优化

### 8.1 异常处理策略

1. 接口异常统一在 Axios 响应拦截器中处理  
2. 请求失败或超时后通过 Toast 进行提示  
3. 保证异常情况下 loading 状态可正常关闭，避免页面阻塞  

### 8.2 用户交互体验优化

1. 所有关键操作均提供即时反馈提示  
2. 防止用户重复提交或高频点击触发重复请求  
3. 表单输入统一进行边界校验与异常兜底处理
4. 首页，搜索列表页加入骨架屏

## 9. 项目可维护性说明

1. 项目目录结构清晰，按业务与功能进行拆分  
2. 公共逻辑集中管理，避免代码分散与重复  
3. 关键业务流程均有明确的状态来源与数据流向  
4. 便于后续功能扩展与重构，不影响现有业务逻辑  

## 10. API 接口层设计说明

1. 本项目对后端请求进行了统一封装，接口按**业务域划分**，  
2. 每个接口函数只负责单一的数据请求或数据更新，不掺杂业务逻辑，  
3. 由 Store 与页面层组合完成完整业务流程，提升可维护性与可读性。
4. 对内嵌数据操作为先获取后全量更新，原因为jsonserver不支持内嵌数据直接post

### 10.1 购物车接口（Cart API）

#### 接口职责说明
购物车接口用于管理**用户维度的购物车数据**，所有操作均基于用户 `id`。

#### 接口说明

- **cartGetService**  
  获取当前用户的购物车商品数据，用于页面初始化与刷新兜底。

- **cartSetService**  
  更新当前用户的购物车商品列表，采用全量更新方式，保证数据一致性。

- **cartInitService**  
  初始化用户购物车数据结构，通常在用户首次注册或首次登录时调用。

#### 设计说明

1. 购物车数据以数组形式集中维护  
2. 所有修改操作统一走全量覆盖，避免局部更新导致状态不一致  
3. 初始化接口用于防止首次访问时数据为空引发异常  

### 10.2 商品接口（Goods API）

#### 接口职责说明
商品接口用于获取商品列表与商品详情数据，并通过缓存机制优化性能。

#### 接口说明

- **goodsGetService**  
  获取全部商品数据，使用 Promise 缓存，避免重复请求。

- **goodsGetAscService**  
  按价格升序获取商品数据，独立缓存。

- **goodsGetDescService**  
  按价格降序获取商品数据，独立缓存。

- **goodsGetRandomService**  
  根据区间随机获取商品数据，用于模拟分页或推荐场景。

- **goodsGetOneService**  
  获取单个商品的详细信息，用于商品详情页与结算页。

#### 设计说明

1. 使用 `Map` 缓存 Promise，避免并发请求重复触发接口  
2. 缓存设置 TTL，有效期内直接复用请求结果  
3. 请求失败时自动清理缓存，确保下次请求可重新拉取数据  

### 10.3 订单接口（Order API）

#### 接口职责说明
订单接口用于管理用户的订单数据集合，与结算流程强相关。

#### 接口说明

- **orderGetService**  
  获取指定用户的全部订单信息。

- **orderSetService**  
  更新用户的订单列表，结算完成后写入新订单数据。

- **orderInitService**  
  初始化用户订单数据结构，避免首次下单时报错。

#### 设计说明

1. 订单数据统一存储在 `AllOrder` 数组中  
2. 新订单采用前插方式，保证最新订单优先展示  
3. 与结算页、订单页形成完整业务闭环  

### 10.4 搜索历史接口（History Search API）

#### 接口职责说明
搜索历史接口用于维护用户的搜索记录数据。

#### 接口说明

- **historyGetService**  
  获取当前的搜索历史数据。

- **historySetService**  
  更新用户搜索历史数组。

- **historyInitService**  
  初始化搜索历史数据结构。

#### 设计说明

1. 搜索历史以数组形式存储  
2. 数据去重、顺序调整由业务层控制  
3. 接口层仅负责数据持久化  

### 10.5 轮播图接口（Swiper API）

#### 接口职责说明
用于获取首页轮播图图片资源。

#### 接口说明

- **swiperGetService**  
  获取轮播图图片 URL 列表。

#### 设计说明

1. 接口职责单一，仅返回图片数据  
2. 由轮播图组件负责渲染与轮播逻辑  

### 10.6 用户接口（User API）

#### 接口职责说明
用户接口用于管理用户账户信息与个人收货信息。

#### 接口说明

- **userRegisterService**  
  提交用户注册信息，并初始化用户相关字段。

- **userGetMessageService**  
  获取全部用户数据，用于登录校验。

- **userInitMessageService**  
  标记用户初始化状态。

- **userGetOneMessageService**  
  获取指定用户的详细信息。

- **userSetPasswordService**  
  修改指定用户的登录密码。

- **userSetMessageService**  
  更新用户的真实收货信息（地址 / 姓名 / 手机号）。

#### 设计说明

1. 使用 `json-server` 的 `id` 模拟用户 token  
2. 用户真实信息与登录信息解耦管理  
3. 收货信息是否完善通过 `express` 字段统一标识  


# vant4组件封装

1. 二次封装 `showToast`
   统一项目内 Toast 调用方式
   自定义样式（位置、背景、阴影等），避免默认样式不一致
   暴露 `message`、`duration` 参数，简化业务层调用

2. 二次封装 `showConfirmDialog`
   原组件参数冗长，业务中频繁使用，故进行封装
   统一确认 / 取消文案参数（`message / yes / no`）
   支持传入 `router`、`route`
   登录拦截场景下，通过 `query.backUrl` 记录来源页面，配合 `replace` 实现登录后回跳

3. 二次封装 `showLoadingToast`
   用于请求加载态展示
   禁止点击、手动关闭
   避免在部分异步仓库操作中使用默认 Toast 造成体验割裂


# 组件封装

## 轮播图组件
### 1.1 说明
1. 该组件为无缝轮播图，支持动态绑定轮播图数量
2. 可通过传入图片URL数组的方式更改图片内容，图片数量不限
   类型（规定传递Array） 属性（imgArray）
   例：imgArray="[]" 必传
3. 属性可选择是否开启指示器
   类型（规定传递Boolean） 属性（nodebox）
   值（true不显示，false显示，默认false） 
4. 属性可设置轮播间隔时长，不可低于500
   类型（规定传递String） 属性（duration）
   例：duration="3000" 默认duration="5000"
5. 属性可设置轮播图框大小，注意：如用用vant4的vw适配要传用vw！！！
   类型（规定传递String）属性（mainWidth/mainHeight）默认（94.66vw/53.33vw）
   例：mainWidth="53.33vw"
### 1.2 功能
1. 内置指示器，表明当前的图片位置
2. 左右按钮控制显示轮播图， 加入节流功能防止频繁点击
3. 自动轮播功能，主动点击切换会重置自动轮播倒计时
4. 图片全部加载完毕才会触发自动轮播/有一张加载失败也会触发（避免卡着不轮播）

## 底部栏Bar
### 2.1 说明
1. 该组件为4处分类的具名插槽封装，支持自定义图标icon以及文字内容text，支持自定义跳转路由
2. 可通过v-slot:one/two/three/four-icon传入icon图标，例：v-slot:one-icon
3. 可通过v-slot:one/two/three/four-text传入text文字内容，例：v-slot:one-text
4. 可设置跳转路由
   类型（规定传递String） 属性（one/two/three/fourRouterGo）
   例：oneRouterGo="/layout/home" 必传
5. 可设置是否存在占位块
   属性（规定传递Boolean） 属性（existSpace）
   值（true存在，false不存在，默认false）
### 2.2 功能
1. 点击对应bar跳转路由，并激活状态active，改变对应的图标及文字颜色

## 顶部栏Bar
### 3.1 说明
1. 该组件为默认插槽顶部栏标题
2. 通过键入文字可改变标题
3. 可设置背景颜色
   类型（规定传递String） 属性（backgroundColor）
   例：backgroundColor="rgb(195, 20, 1)" 默认backgroundColor="rgb(195, 20, 1)"
4. 可设置字体颜色
   类型（规定传递String） 属性（fontColor）
   例：fontColor="#fff"
5. 可选择是否开启返回箭头
   类型（规定传递Boolean） 属性（existBackIcon）
   值：（true存在，false不存在，默认true）
### 3.2 功能
1. 点击左箭头<返回上一页

## 搜索栏
### 4.1 说明
1. 该组件为搜索组件
2. 固定位置与占位块属性为关联属性，见2.可知
3. 当isFixed=true时占位块不存在，isFixed=false时占位块存在，可通过existblock关闭
4. 可设置是否开启固定位置
   类型（规定传递Boolean） 属性（isFixed）
   值（true开启，false关闭，默认false）
5. 可设置不存在占位块
   类型（规定传递Boolean） 属性（existblock）
   值（false不存在，默认false）（仅能设置不存在）
6. 可设置是否进入页面自动聚焦
   类型（规定传递Boolean） 属性（FocusNow）
   值（true开启，false关闭，默认false）
### 4.2 功能
1. 回车向父级上传事件search以及搜索内容，自动清除前后空格，若未输入则不触发
2. 聚焦向父级上传事件onfocus以及true
3. 失焦向父级上传事件onblur以及false
4. 输入向父级上传事件oninput以及输入内容

## 商品卡片
### 5.1 说明
1. 该组件为商品卡片组件，用于展示商品信息
2. 可自定义图片/文字/价格内容
   通过v-slot:proimg/proname/proprice传入对应内容，例：v-slot:proimg
3. 文字/价格内容不限长度，利用不设height设line-height/word-break/direction自动撑开并对齐

## 商品卡片骨架图组件
### 5.1 说明
1. 该组件为商品卡片骨架图组件
2. 可指定骨架图数量
   类型（规定传递Number）属性skeleton，默认10
   例：:skeleton="10"

## 算术计算框组件
### 6.1 说明
1. 该组件为加减计算框组件，也可通过输入方式改变值
2. 组件已屏蔽错误信息返回，如NaN
3. 通过addCount传递值，需写为v-model:addCount="传递的值"
   也可拆分@update:addCount="(count)=>事件(count)" :addCount="Count"，事件内对会接受到传递后被update的Count值

### 6.1 功能
1. 点击加减号/输入input，传递加减/input后的数字
   输入非数字/失焦时为空为0，toast轻提示 请输入数字，并自动重置为1

# 页面处理

## 布局页（Layout）

### 页面功能
- 作为应用的整体布局容器
- 承载二级路由页面内容
- 统一管理底部导航栏组件
- 配合路由缓存控制页面状态

---

### 技术与依赖
- Vue 3（`<script setup>`、Composition API）
- Vue Router（嵌套路由、路由元信息）
- keep-alive（页面缓存）
- 组件通信与条件渲染

---

### 路由与缓存处理
- 使用二级路由作为页面内容出口
- 根据路由 `meta.keepAlive` 控制是否启用缓存
- 缓存页面使用 `keep-alive` 包裹，非缓存页面直接渲染

---

### 底部栏重置机制
- 首页等页面被缓存时，底部栏组件不会自动重建
- 通过 `onActivated` 钩子监听页面重新激活
- 利用条件渲染主动销毁并重新创建底部栏组件
- 通过 `nextTick` 确保组件完全重置后再渲染

---

### 视图实现要点
- 布局页只负责结构，不承载具体业务逻辑
- 页面内容与底部栏解耦，便于维护与扩展
- 底部栏始终保持在布局层统一管理

## 购物车页（Cart）

### 页面功能
- 展示用户购物车商品
- 支持商品勾选、全选与反选
- 支持商品数量修改
- 支持编辑模式下删除商品
- 完成商品结算并跳转至结算页

---

### 技术与依赖
- Vue 3（`<script setup>`、Composition API）
- Pinia（用户状态、购物车状态）
- Vue Router（路由跳转）
- 自定义 Toast（提示与登录引导）

---

### 登录态与数据初始化
- 页面挂载时判断用户登录状态
- 未登录时中断购物车数据请求并提示登录
- 已登录时从 Pinia 获取购物车数据
- 初始化商品选中状态为全选

---

### 商品选中逻辑
- 单个商品选中状态变化时，通过数量对比推导全选状态
- 全选操作统一修改商品的选中字段
- 选中状态完全由购物车数据驱动

---

### 编辑与结算模式
- 通过状态变量区分编辑模式与结算模式
- 编辑模式下取消全选，防止误操作
- 完成编辑后恢复结算模式并重新选中商品

---

### 数量修改、删除与结算
- 数量修改通过事件触发，由 Pinia 统一更新
- 删除操作仅在编辑模式下可用
- 结算前校验登录状态及已选商品
- 提交结算数据并跳转至结算页

---

### 视图实现
- `v-for` 渲染商品列表并设置 `key`
- 条件渲染控制不同模式下的 UI
- 商品图片启用懒加载
- 底部结算栏使用吸底布局

## 分类页（Category）

### 页面功能
- 展示商品分类列表
- 点击分类跳转至搜索列表页
- 通过路由参数传递当前分类名称

---

### 技术与依赖
- Vue 3（`<script setup>`）
- Vue Router（页面跳转、查询参数）

---

### 页面交互逻辑
- 页面通过列表形式展示固定分类项
- 点击分类项时触发点击事件
- 从点击元素中读取分类名称
- 使用路由 `query` 参数跳转至搜索结果页

---

### 路由设计
- 统一跳转至 `/searchlist`
- 使用 `category` 作为查询参数标识当前分类
- 搜索页根据该参数加载对应分类商品

---

### 视图实现
- 分类列表使用 `ul / li` 结构渲染
- 每个分类项绑定点击事件
- 通过阴影与字体样式区分分类模块

## 首页（Home）

### 页面功能
- 展示商城首页核心内容
- 提供搜索入口与分类快捷入口
- 展示轮播图与商品列表
- 支持商品列表滚动加载
- 支持点击商品跳转详情页

---

### 技术与依赖
- Vue 3（`<script setup>`、Composition API）
- Vue Router（页面跳转、参数传递）
- API 请求封装（轮播图、商品数据）
- 组件化设计（搜索栏、轮播图、商品卡片、骨架屏）

---

### 页面初始化逻辑
- 页面挂载后请求轮播图数据
- 请求完整商品列表数据
- 初始只渲染部分商品用于列表展示
- 数据加载完成前展示骨架屏占位

---

### 搜索与分类跳转
- 点击搜索栏跳转至搜索页
- 点击分类标签跳转至商品列表页
- 通过路由 `query` 参数传递分类名称
- 由目标页面根据参数加载对应数据

---

### 商品列表加载机制
- 商品数据分批渲染，避免一次性渲染过多节点
- 通过滚动容器监听滚动事件
- 接近底部时触发商品追加加载
- 当数据加载完成后停止继续加载并更新提示文案

---

### 滚动与页面缓存处理
- 使用可滚动容器替代 window 滚动
- 记录当前滚动位置
- 页面被缓存时恢复上次滚动位置
- 避免页面切换后滚动状态丢失

---

### 视图实现要点
- 轮播图与商品列表均提供骨架屏占位
- 商品图片启用懒加载优化性能
- 商品列表使用组件化卡片渲染
- 底部加载状态通过文案提示

## 我的页面（Mine）

### 页面功能
- 展示用户基础信息与登录状态
- 提供订单、地址、密码等个人功能入口
- 支持用户登录 / 退出登录
- 支持修改密码与登录校验
- 展示随机商品推荐列表

---

### 技术与依赖
- Vue 3（`<script setup>`、Composition API）
- Pinia（用户状态、购物车状态管理）
- Vue Router（页面跳转、回跳处理）
- Vant UI（表单、弹窗、图标）
- 自定义 Toast 封装
- API 模块化请求（用户、商品）

---

### 登录状态控制
- 基于 Pinia 中的 `token` 判断用户是否登录
- 未登录时限制订单、地址、密码等操作
- 通过弹窗引导用户跳转登录页
- 登录成功后自动切换页面展示状态

---

### 用户功能模块
- 我的订单：登录后可访问订单列表
- 我的地址：登录后进入地址管理页面
- 修改密码：弹窗表单校验并提交新密码
- 客服帮助：展示固定联系方式
- 退出登录：清空本地用户与购物车数据

---

### 修改密码逻辑
- 表单校验用户名、原密码、新密码
- 校验规则与接口数据结合验证
- 修改成功后清空表单并提示结果

---

### 商品推荐模块
- 页面加载时随机获取商品数据
- 以卡片形式展示商品信息
- 点击商品跳转至商品详情页

## 登录 / 注册页（Login / Register）

### 页面功能
- 用户登录与用户注册功能整合在同一页面
- 支持登录 / 注册模式切换
- 表单输入校验与错误提示
- 登录成功后初始化用户相关数据
- 支持登录回跳原访问页面

---

### 技术与依赖
- Vue 3（`<script setup>`、Composition API）
- Vue Router（页面跳转、回跳参数）
- Pinia（用户状态与 token 管理）
- 本地表单校验逻辑
- API 模块化请求（用户、购物车、订单、搜索历史）
- 自定义 Toast 提示

---

### 模式切换逻辑
- 通过布尔状态控制登录 / 注册视图切换
- 切换时重置表单内容与校验状态
- 动态调整表单布局样式以适配不同模式

---

### 表单校验
- 用户名校验：5–16 位字母、数字或下划线
- 密码校验：8–16 位字母、数字或下划线
- 注册模式下校验两次密码一致性
- 校验结果通过状态变量统一控制

---

### 注册流程
- 提交前校验表单与用户协议勾选状态
- 检查用户名是否已存在
- 注册成功后切换至登录模式

---

### 登录流程
- 校验用户名与密码
- 登录成功后保存用户信息与 token
- 对首次登录用户初始化：
  - 搜索历史
  - 购物车
  - 订单数据
- 根据路由参数判断是否回跳原页面

## 商品详情页（ProductDetail）

### 页面功能
- 展示单个商品的详细信息
- 支持加入购物车与立即购买
- 显示商品在购物车中的数量状态
- 未登录用户操作时引导登录

---

### 技术与依赖
- Vue 3（`<script setup>`、Composition API）
- Vue Router（动态路由参数、页面跳转）
- Pinia（用户状态、购物车状态）
- 组件化设计（轮播图、数量计数器）
- 自定义 Toast 与确认弹窗

---

### 数据获取逻辑
- 根据路由 `params.id` 获取当前商品信息
- 页面挂载时同步拉取用户购物车数据
- 商品信息与购物车状态分离管理

---

### 购物车状态处理
- 通过计算属性判断商品是否已存在于购物车
- 若已存在则只增加数量
- 若不存在则新增购物车商品项
- 底部购物车图标实时展示商品数量

---

### 购买交互
- 加入购物车：弹窗选择数量后加入
- 立即购买：携带商品 id 与数量跳转结算页
- 所有购买行为均校验登录状态

---

### 交互与视图
- 使用弹窗与过渡动画展示购买操作
- 固定底部购买栏，避免内容遮挡
- 商品主图采用轮播组件展示

## 搜索页（Search）

### 页面职责说明
搜索页用于商品关键词搜索与搜索历史管理，主要功能包括：

- 商品关键词搜索并跳转结果页
- 登录用户搜索历史的记录与管理
- 未登录状态下的搜索引导
- 输入内容联想推荐展示

---

### 技术栈与依赖

- Vue 3 + `<script setup>`
- Composition API：`ref`、`onMounted`、`onUnmounted`
- Pinia：用户登录态管理
- Vue Router：搜索参数传递
- 接口封装：搜索历史、商品数据获取

---

### 登录态与搜索历史逻辑

- 根据用户 token 判断是否为登录状态
- 未登录仅允许搜索，不保存历史记录
- 登录状态下获取并维护个人搜索历史
- 搜索历史按最新优先，最多保留 8 条
- 支持单条删除与全部清空

---

### 搜索与路由交互

- 回车或点击触发搜索行为
- 通过 `query` 参数向搜索结果页传递关键词
- 搜索行为统一使用同一路由出口

---

### 搜索推荐实现

- 页面初始化时获取商品全集数据
- 输入内容使用防抖处理减少计算频率
- 对商品名称进行关键词匹配
- 推荐列表最多展示 5 条结果
- 推荐列表支持延迟隐藏，避免误触

---

### 资源清理

- 页面卸载时统一清除输入防抖与延时定时器
- 避免组件缓存或切换造成的内存占用

## 商品列表页（SearchList / CategoryList）

### 页面职责
用于展示搜索或分类匹配的商品列表，支持排序切换与滚动加载。

---

### 核心技术点

- Vue 3 + `<script setup>`
- Composition API：`ref`、`onMounted`、`nextTick`
- Vue Router：`query / params` 区分搜索与分类来源
- 依赖注入：`inject` 获取视口高度
- 接口分离：默认 / 升序 / 降序商品数据

---

### 商品数据处理

- 页面加载时获取完整商品数据
- 根据路由参数动态筛选匹配商品
- 商品列表采用分段加载，避免一次性渲染
- 单次加载数量固定为 10 条

---

### 排序逻辑设计

- 支持三种排序模式：默认 / 价格升序 / 价格降序
- 不同排序模式使用独立数据源缓存
- 切换排序时清空渲染列表并回到顶部
- 使用状态锁避免重复触发排序逻辑

---

### 滚动加载实现

- 监听主容器 `scroll` 事件
- 距离底部阈值触发加载逻辑
- 使用加载锁与死锁防止多次触发
- 数据加载完成后更新底部提示文案

---

### 用户交互

- 商品卡片点击跳转商品详情页
- 图片开启 `lazy` 懒加载优化性能
- 首次加载展示骨架屏提升体验

## 订单详情页（OrderDetail）

### 页面功能
用于展示指定订单的完整信息，包括收货信息、商品列表及价格明细。

---

### 技术实现

- Vue 3 + `<script setup>`
- Composition API：`ref`、`onMounted`
- Vue Router：通过 `query.code` 定位订单
- Pinia：获取当前登录用户标识
- 接口请求：按用户维度拉取订单数据

---

### 数据处理逻辑

- 页面挂载后获取用户全部订单
- 根据订单编号筛选对应订单对象
- 订单数据统一存储为单一对象供页面渲染

---

### 页面结构说明

- 顶部栏：订单详情标题
- 订单信息区：编号、收货地址、收件人信息
- 商品列表区：商品图片、名称、价格、数量
- 时间展示：下单时间
- 价格明细：单品小计 + 总价汇总

---

### 性能与体验

- 商品图片启用 `lazy` 懒加载
- 列表使用 `key` 保证渲染稳定

## 我的订单（MyOrder）

### 页面功能
用于展示当前用户的全部订单记录，支持查看订单详情与删除订单。

---

### 技术实现

- Vue 3 + `<script setup>`
- Composition API：`ref`、`onMounted`
- Pinia：获取当前登录用户信息
- Vue Router：跳转订单详情页
- 订单接口：获取 / 更新用户订单列表

---

### 核心逻辑

- 页面挂载后根据用户标识拉取全部订单
- 使用列表渲染展示订单基础信息
- 点击「查看详情」跳转订单详情页并携带订单编号
- 删除订单时弹出确认框，确认后更新订单数据并同步接口

---

### 页面结构说明

- 顶部栏：页面标题
- 订单列表区：
  - 订单编号
  - 下单时间
  - 订单总价
  - 查看详情入口
  - 删除订单操作
- 空状态提示：无订单时显示占位文案

---

### 交互与体验

- 删除操作二次确认，避免误删
- 订单列表使用唯一编号作为 `key`
- 无订单时提供明确提示反馈

## 我的地址（UserAddress）

### 页面功能
用于展示并维护用户的收货信息，支持修改姓名、地址与手机号。

---

### 技术实现

- Vue 3 + `<script setup>`
- Composition API：`ref`
- Pinia：存储并更新用户真实信息
- Vant UI：表单、字段校验、按钮
- 自定义 Toast：操作反馈提示

---

### 核心逻辑

- 默认展示当前用户已保存的收货信息
- 点击「变更信息」弹出表单层
- 表单提交前进行姓名、地址、手机号校验
- 提交成功后更新用户信息并提示保存成功

---

### 校验规则说明

- 姓名：中文姓名，长度 2–16
- 地址：包含省、市信息
- 手机号：符合国内手机号格式

---

### 页面结构说明

- 顶部栏：页面标题
- 信息展示区：
  - 姓名
  - 地址
  - 手机号
- 操作按钮：变更信息
- 弹层表单：
  - 信息输入
  - 校验提示
  - 保存 / 取消

---

### 交互与体验

- 表单以弹层形式呈现，避免页面跳转
- 提交后即时反馈保存结果
- 未填写信息时显示占位文案

## 结算页（Settlement）

### 页面功能
用于商品结算，支持从「购物车」或「商品详情页」进入，完成订单信息填写、价格汇总与下单。

---

### 路由来源处理

- 通过 `route.query.from` 区分来源
  - 有 `from`：来自购物车，使用 Pinia 中已勾选商品
  - 无 `from`：来自商品详情页，单独请求商品数据
- 页面刷新时若 Pinia 数据丢失，重新异步拉取购物车数据，保证结算流程可恢复

---

### 状态管理（Pinia）

- `cartStore`
  - 读取勾选商品列表
  - 计算商品总价
  - 下单后删除已购买商品
- `userStore`
  - 获取并维护用户真实收货信息
  - 校验是否已填写完整订单信息

---

### 订单编号生成

- 使用 `Date.now()` + 用户信息拼接生成订单号
- 保证唯一性且无需后端参与

---

### 收货信息表单

- 使用 Vant Form + Field
- 正则校验：
  - 姓名：中文姓名格式
  - 地址：省 / 市完整结构
  - 手机号：国内手机号规则
- 表单以遮罩层形式展示，避免页面跳转

---

### 支付与下单逻辑

- 使用节流阀防止重复点击支付
- 下单流程：
  1. 校验用户信息是否完整
  2. 组装订单对象
  3. 获取历史订单并追加新订单
  4. 更新订单数据
  5. 清空购物车已购买商品
  6. 跳转订单完成页

---

### 生命周期处理

- `onMounted`
  - 拉取商品数据
  - 获取用户真实信息
  - 初始化订单编号
- `onUnmounted`
  - 清除支付节流定时器，防止内存泄漏

---

### 性能与体验优化

- 商品图片使用 `loading="lazy"`
- 底部支付栏使用 `fixed` 定位，始终可操作
- 价格明细与商品列表分区展示，结构清晰

## 支付完成页（Final）

### 页面功能
用于订单支付完成后的结果反馈页面，向用户明确支付状态，并提供后续操作入口。

---

### 页面来源

- 仅由结算页在支付流程完成后跳转进入
- 通过路由 `params` 接收订单编号 `code`

---

### 核心逻辑

- 不参与任何订单生成或数据写入
- 页面只负责：
  - 展示支付成功状态
  - 提供导航跳转能力

---

### 路由跳转说明

- 返回首页：
  - 使用 `router.replace` 跳转至首页路由
  - 避免用户回退至支付流程页面

- 查看订单：
  - 携带订单编号 `code`
  - 跳转至订单页用于查询当前订单详情

---

### 技术实现

- 使用 Vue Router 进行页面跳转
- 通过 `useRoute` 获取订单编号
- 页面无接口请求、无全局状态修改

---

### 页面设计原则

- 页面纯展示，无业务副作用
- 不依赖 Pinia 状态
- 作为下单流程的最终节点存在
